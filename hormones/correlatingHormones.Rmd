---
title: "TAG Pubertal/Hormonal Associations"
author: "Nandi"
date: "28 March 2018"
output: html_document
---

```{r, include=FALSE}
#LOAD PACKAGES AND SET DIRECTORIES

packages <- c("nlme", "ggplot2", "tidyr", "stringr", "knitr","corrplot","data.table", "readxl", "gridExtra", "dplyr", "psych","kableExtra","lavaan","xlsx")
if (length(setdiff(packages, rownames(installed.packages()))) > 0) {
  install.packages(setdiff(packages, rownames(installed.packages())))  
}
lapply(packages, library, character.only = TRUE)

cas_dir <- '/Volumes/psych-cog/dsnlab/TAG/'
age_dir <- paste0(cas_dir,'behavior/Demographics/Age')
saliva_dir <- paste0(cas_dir,'behavior/Saliva/Wave1')
hair_dir <- paste0(cas_dir,'behavior/Hair/Wave1')
quest_dir <- paste0(cas_dir,'behavior/Questionnaires/Waves_12')
menarche_dir <- paste0(cas_dir,'behavior/Puberty_Followup')
options(digits=3)

in_dir <- '~/Downloads/' #to be updated once Saliva Overview Doc is finished.

scaleFUN <- function(x) sprintf("%.1f", x)
```

###IMPORT AGE
```{r, include=FALSE}
#IMPORT AND CLEAN PDS, PBIP DATA
#import PDS and PBIP datasets, create SID as 3 digit numeric factor (i.e. "001").
Age <- read.xlsx(paste0(age_dir,'/DOB_W1W2_SessionDates.xlsx'), sheetIndex=1)
Age <- Age %>% mutate(SID=str_replace(TAG_ID,"TAG","")) %>% 
  filter(!is.na(SID)) %>%
  select(-TAG_ID) %>%
  mutate(ageS1 = round((W1S1_Date - DOB)/365,3),
         ageS2 = round((W1S2_Date - DOB)/365,3))
```

###IMPORT PDS/PBIP
```{r, include=FALSE}
#IMPORT AND CLEAN PDS, PBIP DATA
#import PDS and PBIP datasets, create SID as 3 digit numeric factor (i.e. "001").
PDS <- read.csv(paste0(quest_dir,'/PDS_Wave12.csv'), header=T)
PBIP <- read.csv(paste0(quest_dir,'/PBIP_Wave12.csv'), header=T)
ExtraMens <- read.xlsx(paste0(menarche_dir,'/Menstruation.xlsx'), sheetIndex=1)

PDS <- PDS %>% mutate(SID=str_replace(tagid,"TAG","")) %>% 
  filter(wave==1) %>% 
  select(SID,contains("PDS"),adrenf2,gonadf2) %>%
  filter(!SID == "034")
ExtraMens <- ExtraMens %>%
  select(tagid,menstruation_by_Wave1SB.before.wave.1) %>%
  rename(Menarche = menstruation_by_Wave1SB.before.wave.1) %>%
  mutate(SID=gsub("[^0-9\\.]", "", tagid)) %>%
  filter(!is.na(SID)) %>%
  mutate(Menarche = ifelse(Menarche=="yes",1,0))
Menarche = as.list(ExtraMens %>% filter(Menarche==1) %>% select(SID) %>% arrange(SID))
NoMenarche = as.list(ExtraMens %>% filter(Menarche==0) %>% select(SID) %>% arrange(SID))
  
PDS <- PDS %>%
  mutate(PDS_F6 = ifelse(!is.na(PDS_F6),PDS_F6,
                      ifelse(is.na(PDS_F6) & SID %in% Menarche$SID, 1,
                             ifelse(is.na(PDS_F6) & SID %in% NoMenarche$SID, 0, NA)))) %>%
  mutate(pdss2 = trunc(pdss))

PBIP <- PBIP %>% mutate(SID=str_replace(tagid,"TAG",""),
                        PBIP_stage=stage) %>%
  filter(wave==1) %>% 
  select(SID,contains("PBIP")) %>%
  filter(!SID == "034")

Qdf <- PDS %>% full_join(.,PBIP) 
Qdf2 <- Qdf %>% select(-pdss,-gonadf2,-adrenf2,-PDS_F5,-PDS_F7,-PDS_F8,-PDS_F9,-PBIP_stage)
Qdf2 <- Qdf2[complete.cases(Qdf2), ]

PubModel <- 'puberty =~ PDS_F1 + PDS_F2 + PDS_F3 + PDS_F4 + PDS_F6 + PBIP_1A + PBIP_1B + PBIP_2A + PBIP_2B'
fit <- cfa(PubModel, data = Qdf2)
summary(fit, fit.measures = TRUE)
factor <- as.data.frame(lavPredict(fit))
Qdf2 <- cbind(Qdf2,factor)
Qdf <- Qdf %>% left_join(., Qdf2) %>% rename(puberty_factor = puberty)
```

```{r, include=FALSE}
#ADD HAIR AND PUBERTY MEASURES TO SALIVA DATA
#add hair and puberty measures to saliva data, and re-add session dates so they are not limited to saliva dataset.
df_wide <- Saliva_wide %>% 
  full_join(., Hair) %>%
  left_join(., Qdf) %>%
  left_join(., Age)
```

###PLOT ALL VARIABLES
```{r, echo=FALSE, message=FALSE, warning=FALSE, results="asis", fig.height=4, fig.width=4}
writeLines("\n")
hist(df_wide$puberty_factor, main="")
writeLines("\n")
hist(df_wide$pdss, main="")
writeLines("\n")
hist(df_wide$PBIP_stage, main="")
writeLines("\n")
hist(df_wide$meanDHEA, main="")
writeLines("\n")
hist(df_wide$meanTEST, main="")
writeLines("\n")
hist(df_wide$meanEST, main="")
writeLines("\n")
hist(df_wide$hair_DHEA_pgmg, main="")
writeLines("\n")
hist(df_wide$hair_TEST_pgmg, main="")
writeLines("\n")
hist(df_wide$hair_EST_pgug, main="")
writeLines("\n")

df_wide <- df_wide %>%
  mutate(salivaDHEA = log(meanDHEA + 4),
         salivaTEST = log(meanTEST + 4),
         salivaEST = log(meanEST + 4),
         hairDHEA = log(hair_DHEA_pgmg + 4),
         hairTEST = log(hair_TEST_pgmg + 4),
         hairEST = log(hair_EST_pgug + 4)) %>%
  rename(PDS_adrenal = adrenf2,
         PDS_gonadal = gonadf2,
         PDS = pdss,
         PBIP = PBIP_stage,
         Puberty = puberty_factor)

df_wide <- df_wide %>% 
  mutate(hairTEST = replace(hairTEST, (hairTEST > 2.05), NA))

barplot_age <- ggplot(subset(df_wide, !is.na(ageS1)), aes(round(as.numeric(ageS1),2))) +
    geom_histogram(binwidth = 0.1, colour="grey",fill="dodgerblue3",
                   breaks=seq(9.8, 13.2, by = 0.5))+
    xlim(9.5,13.5) +
    xlab("Age") +
    scale_y_continuous(limits = c(0, 40), breaks = seq(0,40,by=10))+
    theme_bw() +
    theme_minimal(base_size = 12, base_family = "Arial") +
    theme(axis.line = element_line(colour = "black"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.border = element_blank(),
          panel.background = element_blank(),
          legend.position="none")

barplot_PDS <- ggplot(subset(df_wide, !is.na(PDS)), aes(trunc(PDS))) +
    geom_bar() + 
    xlim(0.5,5.5) +
    xlab("PDS")+
    scale_y_continuous(limits = c(0, 40), breaks = seq(0,40,by=10))+
    theme_bw() +
    theme_minimal(base_size = 12, base_family = "Arial") +
    theme(axis.line = element_line(colour = "black"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.border = element_blank(),
          panel.background = element_blank(),
          legend.position="none")

barplot_PBIP <- ggplot(subset(df_wide, !is.na(PBIP)), aes(trunc(PBIP))) +
    geom_bar() + 
    xlim(0.5,5.5) +
    xlab("PBIP")+
    scale_y_continuous(limits = c(0, 40), breaks = seq(0,40,by=5))+
    theme_bw() +
    theme_minimal(base_size = 12, base_family = "Arial") +
    theme(axis.line = element_line(colour = "black"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.border = element_blank(),
          panel.background = element_blank(),
          legend.position="none")

barplot_Puberty <- ggplot(subset(df_wide, !is.na(Puberty)), aes(trunc(PDS), Puberty)) +
    geom_point() + 
    geom_smooth(method=lm) +
    xlab("PDS")+
    theme_bw() +
    theme_minimal(base_size = 12, base_family = "Arial") +
    theme(axis.line = element_line(colour = "black"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.border = element_blank(),
          panel.background = element_blank(),
          legend.position="none")
```

###CORRELATE DATA
```{r, echo=FALSE, message=FALSE, warning=FALSE, results="asis", fig.height=7, fig.width=7}
corr_df <- df_wide[-1] %>% select(salivaDHEA,salivaTEST,salivaEST,hairDHEA,hairTEST,hairEST,PDS_adrenal,PDS_gonadal,PDS,PBIP,Puberty) 
corr_plot <- cor(corr_df,use="pairwise.complete.obs")
res1 <- corr.test(corr_df, adjust = "none")
corr_heatmap_overall <- corrplot(corr_plot, p.mat = res1$p, method = "color", type = "upper",
                                 sig.level = c(0.001,0.01,0.05), pch.cex = .9,
                                 insig = "label_sig", pch.col = "white")

kable(corr_plot, "html", align='c', caption = "Correlation Coefficients") %>%
  kable_styling(full_width = F, position = "left", font_size = 12)

count <- count.pairwise(corr_df)
kable(count, "html", align='c', caption = "Sample size of pairwise comparisons") %>%
  kable_styling(full_width = F, position = "left", font_size = 12)
```  

####PLOT HORMONES & PUBERTY CORRELATIONS
```{r, echo=FALSE, message=FALSE, warning=FALSE, results="asis", fig.height=4, fig.width=4}
corplot_hDHEA_sal <- ggplot(df_wide, aes(salivaDHEA, hairDHEA),label=sprintf("%0.2f", round(a, digits = 2))) +
  geom_point() +
  geom_smooth(method="lm") +
  ylab("Hair DHEA (pgmg)")+
  xlab("Saliva DHEA (pgml)")+
  scale_y_continuous(limits = c(1.5, 4), breaks = seq(1.5,4,by=1),labels = scaleFUN)+
  scale_x_continuous(limits = c(2.8, 6.2), breaks = seq(3,6,by=1),labels = scaleFUN)+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
corplot_hTEST_sal <- ggplot(df_wide, aes(salivaTEST, hairTEST)) +
  geom_point() +
  geom_smooth(method="lm") +
  ylab("Hair TEST (pgmg)")+
  xlab("Saliva TEST (pgml)")+
  scale_y_continuous(limits = c(1.5, 2.1), breaks = seq(1.5,2.5,by=0.2),labels = scaleFUN)+
  scale_x_continuous(limits = c(2.8, 5.2), breaks = seq(3,5,by=1),labels = scaleFUN)+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
corplot_hEST_sal <- ggplot(df_wide, aes(salivaEST, hairEST)) +
  geom_point() +
  geom_smooth(method="lm")+
  ylab("Hair EST (pgug)")+
  xlab("Saliva EST (pgml)")+
  scale_y_continuous(limits = c(3.3, 4.5), breaks = seq(3.3,4.5,by=0.4),labels = scaleFUN)+
  scale_x_continuous(limits = c(1.45, 1.95), breaks = seq(1.5,1.9,by=0.2),labels = scaleFUN)+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")

corplot_hDHEA_pds <- ggplot(df_wide, aes(PDS, hairDHEA)) +
  geom_point() + 
  xlim(1,5) +
  geom_smooth(method="lm") +
  ylab("Hair DHEA (pgmg)")+
  xlab("PDS")+
  scale_y_continuous(limits = c(1.5, 4), breaks = seq(1.5,4,by=1),labels = scaleFUN)+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
corplot_hTEST_pds <- ggplot(df_wide, aes(PDS, hairTEST)) +
  geom_point() +
  xlim(1,5) +
  geom_smooth(method="lm")+
  ylab("Hair TEST (pgmg)")+
  xlab("PDS")+
  scale_y_continuous(limits = c(1.5, 2.1), breaks = seq(1.5,2.5,by=0.2),labels = scaleFUN)+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
corplot_hEST_pds <- ggplot(df_wide, aes(PDS, hairEST)) +
  geom_point() +
  xlim(1,5) +
  geom_smooth(method="lm") +
  ylab("Hair EST (pgug)")+
  xlab("PDS")+
  scale_y_continuous(limits = c(3.3, 4.5), breaks = seq(3.3,4.5,by=0.4),labels = scaleFUN)+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")

corplot_sDHEA_pds <- ggplot(df_wide, aes(PDS, salivaDHEA)) +
  geom_point() +
  xlim(1,5) +
  geom_smooth(method="lm") +
  ylab("Saliva DHEA (pgmg)")+
  xlab("PDS")+
  scale_y_continuous(limits = c(2.8, 6.2), breaks = seq(3,6,by=1),labels = scaleFUN)+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
corplot_sTEST_pds <- ggplot(df_wide, aes(PDS, salivaTEST)) +
  geom_point() +
  xlim(1,5) +
  geom_smooth(method="lm") + 
  ylab("Saliva TEST (pgml)")+
  xlab("PDS")+
  scale_y_continuous(limits = c(2.8, 5.2), breaks = seq(3,5,by=1),labels = scaleFUN)+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
corplot_sEST_pds <- ggplot(df_wide, aes(PDS, salivaEST)) +
  geom_point() +
  xlim(1,5) +
  geom_smooth(method="lm") +
  ylab("Saliva EST (pgml)")+
  xlab("PDS")+
  scale_y_continuous(limits = c(1.45, 1.95), breaks = seq(1.5,1.9,by=0.2),labels = scaleFUN)+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")

writeLines("\n")
corplot_hDHEA_sal
cor.test(df_wide$hairDHEA,df_wide$salivaDHEA)
writeLines("\n")
corplot_hTEST_sal
cor.test(df_wide$hairTEST,df_wide$salivaTEST)
writeLines("\n")
corplot_hEST_sal
cor.test(df_wide$hairEST,df_wide$salivaEST)
writeLines("\n")
corplot_hDHEA_pds
writeLines("\n")
corplot_hTEST_pds
writeLines("\n")
corplot_hEST_pds
writeLines("\n")
corplot_sDHEA_pds
writeLines("\n")
corplot_sTEST_pds
writeLines("\n")
corplot_sEST_pds
writeLines("\n")
```

####PLOT CORRELATIONS BY MENARCHE
```{r, echo=FALSE, message=FALSE, warning=FALSE, results="asis", fig.height=4, fig.width=5, include = FALSE}
Menarche <- PDS %>% select(SID,PDS_F6)

df_wide <- df_wide %>%
  left_join(., Menarche) %>%
  mutate(menarche = as.factor(PDS_F6)) %>%
  mutate(pub_cat = if_else(PDS < 3, 0, 1)) %>%
  mutate(pub_cat = as.factor(pub_cat))

corplot_hDHEA_men <- ggplot(df_wide, aes(PDS, hairDHEA, group = menarche)) +
  geom_point(aes(colour = menarche)) +
  #ylim(0,50) + 
  xlim(1,5) +
  geom_smooth(aes(colour = menarche), method="lm")

corplot_hTEST_men <- ggplot(df_wide, aes(PDS, hairTEST, group = menarche)) +
  geom_point(aes(colour = menarche)) +
  #ylim(0,50) + 
  xlim(1,5) +
  geom_smooth(aes(colour = menarche), method="lm")

corplot_hEST_men <- ggplot(df_wide, aes(PDS, hairEST, group = menarche)) +
  geom_point(aes(colour = menarche)) +
  #ylim(0,50) + 
  xlim(1,5) +
  geom_smooth(aes(colour = menarche), method="lm")

corplot_sDHEA_men <- ggplot(df_wide, aes(PDS, salivaDHEA, group = menarche)) +
  geom_point(aes(colour = menarche)) +
  #ylim(0,50) + 
  xlim(1,5) +
  geom_smooth(aes(colour = menarche), method="lm")

corplot_sTEST_men <- ggplot(df_wide, aes(PDS, salivaTEST, group = menarche)) +
  geom_point(aes(colour = menarche)) +
  #ylim(0,50) + 
  xlim(1,5) +
  geom_smooth(aes(colour = menarche), method="lm")

corplot_sEST_men <- ggplot(df_wide, aes(PDS, salivaEST, group = menarche)) +
  geom_point(aes(colour = menarche)) +
  #ylim(0,50) + 
  xlim(1,5) +
  geom_smooth(aes(colour = menarche), method="lm")

corplot_hDHEA_men
writeLines("\n")
corplot_hTEST_men
writeLines("\n")
corplot_hEST_men
writeLines("\n")
corplot_sDHEA_men
writeLines("\n")
corplot_sTEST_men
writeLines("\n")
corplot_sEST_men
writeLines("\n")
```

###FACTOR ANALYSIS
```{r, echo=FALSE, message=FALSE, warning=FALSE, results="asis", fig.height=4, fig.width=5}
DF <- df_wide %>% select(starts_with("l_"), PDS_F1, PDS_F2, PDS_F3, PDS_F4, PDS_F6, PBIP_1A, PBIP_2A)
  
DF <- DF[complete.cases(DF), ]

res1b = factanal(na.omit(DF), factors = 3, rotation = "varimax")

load = res1b$loadings[,c(1,2)]
plot(load, type="n") # set up plot
text(load,labels=names(DF),cex=.7) # add variable names
```

###PUBERTY predicted by hormones
```{r, include = FALSE}
summary(lm(Puberty~salivaDHEA+hairDHEA,df_wide))
summary(lm(Puberty~salivaTEST+hairTEST,df_wide))
summary(lm(Puberty~salivaEST+hairEST,df_wide))
```

###SCORE PARENT PDS
```{r}
PDS_parent <- read.csv("~/Desktop/TAG_parentPDS.csv",header=T)

PDS_parent$SID <- sprintf("%03d", PDS_parent$SID)

PDS_parent<-PDS_parent %>% 
  mutate(peta=PDS_F1,
         petb=PDS_F2,
         petc=PDS_F3,
         petd=PDS_F4,
         fpete=PDS_F6,
         petaf=ifelse(PDS_F1==1,1,
                      ifelse(PDS_F1==2,2,
                             ifelse(PDS_F1==3,3,
                                    ifelse(PDS_F1==4,5,
                                           NA)))),
         petbf=ifelse(PDS_F2==1,1,
                      ifelse(PDS_F2==2,2,
                             ifelse(PDS_F2==3,4,
                                    ifelse(PDS_F2==4,5,
                                           NA)))),
         petcf=ifelse(PDS_F3==1,1,
                      ifelse(PDS_F3==2,2,
                             ifelse(PDS_F3==3,4,
                                    ifelse(PDS_F3==4,5,
                                           NA)))),
         petdf=ifelse(PDS_F4==1,1,
                      ifelse(PDS_F4==2,3,
                             ifelse(PDS_F4==3,4,
                                    ifelse(PDS_F4==4,5,
                                           NA)))),         
         petef=ifelse(PDS_F6==1,1,
                      ifelse(PDS_F6==2,5,
                             NA))) %>%
  mutate(adrenf=rowMeans(cbind(petbf,petcf),na.rm=F)) %>%
  mutate(adrenf2=ifelse(adrenf==1,1,
                        ifelse(petb==1 & adrenf==1.5,1,
                               ifelse(petb==2 & adrenf==1.5,2,
                                      ifelse(adrenf==2,2,
                                             ifelse(adrenf==2.5,3,
                                                    ifelse(adrenf==3,3,
                                                           ifelse(adrenf==3.5,4,
                                                                  ifelse(adrenf==4,4,
                                                                         ifelse(adrenf==4.5,5,
                                                                                ifelse(adrenf==5,5,
                                                                                       NA))))))))))) %>%
  mutate(gonadf=rowMeans(cbind(petaf,petdf),na.rm=F)) %>%
  mutate(gonadf2=ifelse(gonadf==1 & petef==1,1,
                        ifelse(gonadf==1.5 & petef==1,1,
                               ifelse(gonadf==2 & petef==1,2,
                                      ifelse(gonadf==2.5 & petef==1,2,
                                             ifelse(gonadf==3 & petef==1,3,
                                                    ifelse(gonadf==3.5 & petef==1,3,
                                                           ifelse(gonadf==4 & petef==1,3,
                                                                  ifelse(gonadf==4.5 & petef==1,4,
                                                                         ifelse(gonadf==5 & petef==1,4,
                                                                                ifelse(gonadf==1 & petef==5,2,
                                                                                       ifelse(gonadf==1.5 & petef==5,3,
                                                                                              ifelse(gonadf==2 & petef==5,4,
                                                                                                     ifelse(gonadf==2.5 & petef==5,4,
                                                                                                            ifelse(gonadf==3 & petef==5,4,
                                                                                                                   ifelse(gonadf==3.5 & petef==5,5,
                                                                                                                          ifelse(gonadf==4 & petef==5,5,
                                                                                                                                 ifelse(gonadf==4.5 & petef==5,5,
                                                                                                                                        ifelse(gonadf==5 & petef==5,5,
                                                                                                                                               NA))))))))))))))))))) %>%
  mutate(pdss=rowMeans(cbind(adrenf2,gonadf2),na.rm=F)) 

PDS_parent <- PDS_parent %>% 
  rename(PDS_adrenal_p = adrenf2,
         PDS_gonadal_p = gonadf2,
         PDS_p = pdss) %>%
  select(SID, contains("_p")) 

  #mutate(PDS_p = trunc(pdss_p)) %>%
  #mutate(pdss2_p = as.factor(pdss2_p))

         #adrenf3_p = as.factor(adrenf2_p,levels=c(1,2,3,4,5)),
         #gonadf3_p = as.factor(gonadf2_p, levels=c(1,2,3,4,5)))
```


```{r, echo=FALSE}
df_wide<-df_wide %>% left_join(.,PDS_parent)

gonadal <- ggplot(subset(df_wide, !is.na(PDS_gonadal_p)), aes(PDS_gonadal_p)) +
  geom_bar() + 
  xlim(0.5,5.5) +
  xlab("PDS Gonadal")+
  scale_y_continuous(limits = c(0, 10), breaks = seq(0,10,by=2))+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")

adrenal <- ggplot(subset(df_wide, !is.na(PDS_adrenal_p)), aes(PDS_adrenal_p)) +
  geom_bar() + 
  xlim(0.5,5.5) +
  xlab("PDS Adrenal")+
  scale_y_continuous(limits = c(0, 10), breaks = seq(0,10,by=2))+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
  

corr_df <- df_wide[-1] %>% select(salivaDHEA,salivaTEST,salivaEST,hairDHEA,hairTEST,hairEST,PDS_p,PDS_adrenal_p,PDS_gonadal_p)
corr_plot <- cor(corr_df,use="pairwise.complete.obs")
res1 <- corr.test(corr_df, adjust = "none")
corr_heatmap_overall <- corrplot(corr_plot, p.mat = res1$p, method = "color", type = "upper",
                                 sig.level = c(0.001,0.01,0.05), pch.cex = .9,
                                 insig = "label_sig", pch.col = "white")

corplot_sEST_p <- ggplot(df_wide, aes(PDS_p, salivaEST)) +
  geom_point() +
  xlim(1,5) +
  geom_smooth(method="lm")+
  ylab("Saliva EST (pgml)")+
  xlab("PDS")+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
corplot_sTEST_p <- ggplot(df_wide, aes(PDS_p, salivaTEST)) +
  geom_point() +
  ylim(1,5) +
  xlim(1,5) +
  geom_smooth(method="lm")+
  ylab("Saliva TEST (pgml)")+
  xlab("PDS")+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
corplot_sDHEA_p <- ggplot(df_wide, aes(PDS_p, salivaDHEA)) +
  geom_point() +
  xlim(1,5) +
  geom_smooth(method="lm")+
  ylab("Saliva DHEA (pgml)")+
  xlab("PDS")+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
corplot_hEST_p <- ggplot(df_wide, aes(PDS_p, hairEST)) +
  geom_point() +
  xlim(1,5) +
  geom_smooth(method="lm")+
  ylab("Hair EST (pgug)")+
  xlab("PDS")+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
corplot_hTEST_p <- ggplot(df_wide, aes(PDS_p, hairTEST)) +
  geom_point() +
  ylim(1,5) +
  xlim(1,5) +
  geom_smooth(method="lm")+
  ylab("Hair TEST (pgmg)")+
  xlab("PDS")+
  scale_y_continuous(limits = c(1.3, 2.1), breaks = seq(1.3,2.5,by=0.2),labels = scaleFUN)+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
corplot_hDHEA_p <- ggplot(df_wide, aes(PDS_p, hairDHEA)) +
  geom_point() +
  xlim(1,5) +
  geom_smooth(method="lm")+
  ylab("Hair DHEA (pgmh)")+
  xlab("PDS")+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")

corplot_hEST_gonadal_p <- ggplot(df_wide, aes(PDS_gonadal_p, hairEST)) +
  geom_point() +
  xlim(1,5) +
  geom_smooth(method="lm")+
  ylab("Hair EST (pgug)")+
  xlab("PDS")+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
```

```{r}
corplot_TEST_p <- ggplot(df_wide) +
  geom_point(aes(PDS_p, hairTEST), color="darkseagreen3") +
  geom_smooth(aes(PDS_p, hairTEST), method="lm", color="darkseagreen3")+
  geom_point(aes(PDS_p, salivaTEST), color="gray56") +
  geom_smooth(aes(PDS_p, salivaTEST), method="lm", color="gray56") +
  ylim(1,5) +
  xlim(1,5) +
  ylab("TEST")+
  xlab("PDS")+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")

corplot_EST_p <- ggplot(df_wide) +
  geom_point(aes(PDS_p, hairEST_pgmg), color="darkseagreen3") +
  geom_smooth(aes(PDS_p, hairEST_pgmg), method="lm", color="darkseagreen3")+
  geom_point(aes(PDS_p, salivaEST), color="gray56") +
  geom_smooth(aes(PDS_p, salivaEST), method="lm", color="gray56") +
  ylim(0,2) +
  xlim(1,5) +
  ylab("EST")+
  xlab("PDS")+
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")

corplot_DHEA_p <- ggplot(df_wide) +
  geom_point(aes(PDS_p, hairDHEA), color="darkseagreen3") +
  geom_smooth(aes(PDS_p, hairDHEA), method="lm", color="darkseagreen3")+
  geom_point(aes(PDS_p, salivaDHEA), color="gray56") +
  geom_smooth(aes(PDS_p, salivaDHEA), method="lm", color="gray56")+
  ylim(1,6) +
  xlim(1,5) +
  ylab("DHEA") +
  xlab("PDS") +
  theme_bw() +
  theme_minimal(base_size = 12, base_family = "Arial") +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
```

```{r,include=FALSE}
#Write figures for SRA presentation
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/barplotAge.png', plot=barplot_age, width = 2.5, height = 2.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/barplotPDS.png', plot=barplot_PDS, width = 2.5, height = 2.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/corplot_hDHEA_sal.png', plot=corplot_hDHEA_sal, width = 3.5, height = 3.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/corplot_hTEST_sal.png', plot=corplot_hTEST_sal, width = 3.5, height = 3.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/corplot_hEST_sal.png', plot=corplot_hEST_sal, width = 3.5, height = 3.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/corplot_hDHEA_pds.png', plot=corplot_hDHEA_pds, width = 3.5, height = 3.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/corplot_hTEST_pds.png', plot=corplot_hTEST_pds, width = 3.5, height = 3.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/corplot_hEST_pds.png', plot=corplot_hEST_pds, width = 3.5, height = 3.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/corplot_sDHEA_pds.png', plot=corplot_sDHEA_pds, width = 3.5, height = 3.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/corplot_sTEST_pds.png', plot=corplot_sTEST_pds, width = 3.5, height = 3.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/corplot_sEST_pds.png', plot=corplot_sEST_pds, width = 3.5, height = 3.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/barplot_PDS_gonadal_p.png', plot=gonadal, width = 3.5, height = 3.5)
ggsave(filename='/Volumes/StorEDGE/WORK/DSN/TAG/SRA/barplot_PDS_adrenal_p.png', plot=adrenal, width = 3.5, height = 3.5)
