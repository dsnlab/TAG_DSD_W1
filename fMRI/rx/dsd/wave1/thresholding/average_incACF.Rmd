---
title: "average_indACF"
author: "Nandi"
date: "29 September 2018"
output: html_document
---

```{r}
packages <- c("tidyr", "stringr","data.table", "dplyr","stringi")
if (length(setdiff(packages, rownames(installed.packages()))) > 0) {
  install.packages(setdiff(packages, rownames(installed.packages())))  
}
lapply(packages, library, character.only = TRUE)

options(digits=5)
```

#final DSD subject list
```{r}
dsd_overview <- read.csv('~/Desktop/dsd_overview.csv',header=T)

dsd_overview <- dsd_overview %>% filter(Withdrawn_W1==0) %>% filter(W1S2_Completed==1) %>% filter(!check_mri_completed.2.partial.1.full.0.none.==0) %>% filter(dsd_completed==2) %>% filter(is.na(technical_missing)) %>% filter(is.na(participant_error)) %>% filter(is.na(fx_QC_problem)) %>% filter(is.na(too_much_missing))

dsd_overview <- dsd_overview %>% 
  left_join(., motionExc, by="SID") %>%
  filter(is.na(motionExc))

finalList <- dsd_overview$SID
```

```{r}
fileDir='/Volumes/psych-cog/dsnlab/TAG/nonbids_data/fMRI/fx/models/dsd/wave1/pmod/MLmotion_AR_RT/'

file_list = list.files(fileDir, pattern="acf.txt",recursive=T)

files <- lapply(file_list, FUN=function(file) {
  
  sid = gsub("/.*$", "", file)
    
  dataset <- read.table(paste0(fileDir, file)) %>%
    group_by() %>%
    summarise(X = mean(V6,na.rm=T),
              Y = mean(V7,na.rm=T),
              Z = mean(V8,na.rm=T)) %>%
    mutate(sid = sid) }) 
  
files <- rbindlist(files) %>%
  mutate(sid = as.numeric(gsub("sub-TAG","",sid))) %>%
  filter(sid %in% finalList) #limit FX models to final dsd list (i.e. excluding those with bad motion)

summaryACF <- files %>% group_by() %>%
    summarise(Xmean = mean(X,na.rm=T),
              Ymean = mean(Y,na.rm=T),
              Zmean = mean(Z,na.rm=T),
              Xmedian = median(X,na.rm=T),
              Ymedian = median(Y,na.rm=T),
              Zmedian = median(Z,na.rm=T))

#SPM FAST: 
#Xmean	Ymean	Zmean	Xmedian	Ymedian	Zmedian
#0.73527	4.6591	12.53	0.73074	4.6192	12.332

#SPM AR: 
#Xmean	Ymean	Zmean	Xmedian	Ymedian	Zmedian
#0.73478	4.6649	12.535	0.7304	4.636	12.33
